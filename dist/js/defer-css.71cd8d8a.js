(function() {'use strict';window.__deferCssDebug = {started: Date.now(),logs: []};function debugLog(msg) {const timestamp = Date.now() - window.__deferCssDebug.started;window.__deferCssDebug.logs.push(`[${timestamp}ms] ${msg}`);console.log('[defer-css]', msg);}debugLog('Script started');let assetManifest = window.__assetManifest__ || {};let manifestSize = Object.keys(assetManifest).length;debugLog('Asset manifest loaded: ' + manifestSize + ' entries');async function ensureManifest() {if (manifestSize === 0) {debugLog('WARNING: Manifest is empty. Attempting to fetch /asset-manifest.json as fallback.');try {const controller = new AbortController();const timeout = setTimeout(() => controller.abort(), 800);const res = await fetch('/asset-manifest.json', { method: 'GET', cache: 'no-store', signal: controller.signal });clearTimeout(timeout);if (res && res.ok) {const data = await res.json();if (data && Object.keys(data).length) {assetManifest = data;manifestSize = Object.keys(assetManifest).length;debugLog('Fetched asset manifest fallback from /asset-manifest.json: ' + manifestSize + ' entries');} else {debugLog('Fetched manifest fallback was empty');}} else {debugLog('Failed to fetch manifest fallback (non-ok response)');}} catch (e) {debugLog('Error fetching manifest fallback: ' + (e && e.message ? e.message : e));}}}(async function initDeferredStyles() {await ensureManifest();const indexDeferredCss = assetManifest['styles-index-deferred.css'];let commonDeferredCss = assetManifest['css/components-deferred.css'];debugLog('Index deferred CSS lookup: "styles-index-deferred.css" -> ' + (indexDeferredCss || 'NOT FOUND'));debugLog('Common deferred CSS lookup: "css/components-deferred.css" -> ' + (commonDeferredCss || 'NOT FOUND'));if (!commonDeferredCss) {commonDeferredCss = assetManifest['css/components-reusable.css'] || assetManifest['components-reusable.css'] || null;if (commonDeferredCss) {debugLog('Fallback: found components-reusable in manifest -> ' + commonDeferredCss);} else {debugLog('Fallback: components-reusable not in manifest, will use /css/components-reusable.css if available');commonDeferredCss = null; // explicit null, will fallback to path when used}}const deferredStyles = {'index': indexDeferredCss ? '/' + indexDeferredCss : null,  // Homepage below-fold sections'common': commonDeferredCss ? '/' + commonDeferredCss : '/css/components-reusable.css'  // Common interactive styles};if (!indexDeferredCss) {debugLog('WARNING: Index deferred CSS not found in manifest - styles may not load!');}if (!assetManifest['css/components-deferred.css']) {debugLog('WARNING: Common deferred CSS not found in manifest - using fallback: ' + deferredStyles['common']);}debugLog('Deferred styles resolved: ' + JSON.stringify(deferredStyles));function loadDeferredCSS(href) {debugLog('Loading deferred CSS: ' + href);const link = document.createElement('link');link.rel = 'stylesheet';link.href = href;link.media = 'print';  // Load without blocking renderlink.onload = function() {debugLog('CSS loaded (onload): ' + href + ', setting media to all');this.media = 'all';  // Apply styles after loaded};link.onerror = function() {debugLog('ERROR loading CSS: ' + href);};setTimeout(function() {debugLog('Timeout fired for ' + href + ', setting media to all');link.media = 'all';}, 3000);document.head.appendChild(link);debugLog('Link element appended to head: ' + href);}function loadPageDeferredCSS() {debugLog('loadPageDeferredCSS called');debugLog('document.readyState: ' + document.readyState);debugLog('document.head: ' + (document.head ? 'exists' : 'MISSING'));if (deferredStyles['common']) {debugLog('Loading common deferred styles');loadDeferredCSS(deferredStyles['common']);} else {debugLog('ERROR: No common deferred styles to load - manifest may be empty or CSS not found in manifest');}const isIndex = document.body.classList.contains('home') ||window.location.pathname === '/' ||window.location.pathname === '/index.html';debugLog('Is index page: ' + isIndex + ' (pathname: ' + window.location.pathname + ')');if (isIndex) {if (deferredStyles['index']) {debugLog('Loading index deferred styles');loadDeferredCSS(deferredStyles['index']);} else {debugLog('ERROR: This is index page but no index deferred styles available - manifest issue');}} else {debugLog('Not loading index styles (non-index page detected)');debugLog('Page-specific CSS is already preloaded and converted to stylesheet by init-preload.js');}}if (document.readyState === 'loading') {debugLog('Document loading, waiting for DOMContentLoaded');document.addEventListener('DOMContentLoaded', function() {debugLog('DOMContentLoaded fired');requestAnimationFrame(function() {debugLog('requestAnimationFrame fired');setTimeout(loadPageDeferredCSS, 100);});});} else {debugLog('Document already loaded, calling immediately');requestAnimationFrame(function() {debugLog('requestAnimationFrame fired');setTimeout(loadPageDeferredCSS, 100);});}})();})();