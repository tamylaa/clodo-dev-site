(function() {'use strict';const CONFIG = {CLOUDFLARE_TOKEN: '049306cd3cd546ae91b66ebd97a71b89',WAIT_FOR_LCP: true,MIN_DELAY: 1000,MAX_LCP_WAIT: 5000};function shouldLoadAnalytics() {if (navigator.doNotTrack === '1' || window.doNotTrack === '1') {return false;}if (window.__cfBeacon || document.querySelector('script[src*="cloudflareinsights"]')) {console.log('Analytics: Already loaded, skipping');return false;}return true;}function sendBeaconViaProxy() {try {if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {console.log('Analytics: Skipped on localhost');return;}const data = {cu: window.location.href,};fetch('/api/analytics', {method: 'POST',headers: {'Content-Type': 'application/json'},body: JSON.stringify({token: CONFIG.CLOUDFLARE_TOKEN,data: data}),keepalive: true}).catch(() => {});console.log('Analytics: Beacon sent via proxy after LCP');} catch (error) {}}function loadAnalyticsAfterLCP() {let lcpComplete = false;let timeoutId;if ('PerformanceObserver' in window && 'PerformanceEventTiming' in window) {try {const observer = new PerformanceObserver(function(list) {const entries = list.getEntries();const lastEntry = entries[entries.length - 1];if (lastEntry && !lcpComplete) {lcpComplete = true;clearTimeout(timeoutId);scheduleAnalyticsLoad();}});observer.observe({ type: 'largest-contentful-paint', buffered: true });} catch (e) {scheduleAnalyticsLoad();}} else {scheduleAnalyticsLoad();}timeoutId = setTimeout(function() {if (!lcpComplete) {lcpComplete = true;scheduleAnalyticsLoad();}}, CONFIG.MAX_LCP_WAIT);}function scheduleAnalyticsLoad() {setTimeout(function() {if ('requestIdleCallback' in window) {requestIdleCallback(function() {sendBeaconViaProxy();}, { timeout: 3000 });} else {requestAnimationFrame(function() {setTimeout(function() {sendBeaconViaProxy();}, 0);});}}, CONFIG.MIN_DELAY);}function initAnalytics() {if (!shouldLoadAnalytics()) {return;}if (document.readyState === 'loading') {document.addEventListener('DOMContentLoaded', function() {if (CONFIG.WAIT_FOR_LCP) {loadAnalyticsAfterLCP();} else {scheduleAnalyticsLoad();}});} else {if (CONFIG.WAIT_FOR_LCP) {loadAnalyticsAfterLCP();} else {scheduleAnalyticsLoad();}}}initAnalytics();})();