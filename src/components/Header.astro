---
// src/components/Header.astro
// Main navigation header with logo, nav menu, and mobile toggle
// Provides: responsive navbar, dropdown menus, mobile hamburger

export interface Props {
  currentPath?: string;
}

const { currentPath } = Astro.props;

const navItems = [
  { label: 'Home', href: '/' },
  {
    label: 'Product',
    href: '/product/',
    submenu: [
      { label: 'Overview', href: '/product/' },
      { label: 'Migrate', href: '/migrate/' },
      { label: 'Community', href: '/community/' }
    ]
  },
  {
    label: 'Learn',
    href: '#',
    submenu: [
      { category: 'ðŸ“š Documentation', items: [
        { label: 'Getting Started', href: '/docs/' },
        { label: 'Components', href: '/components/' },
        { label: 'Development & Deployment', href: '/development-deployment-guide/' },
        { label: 'API Simplification', href: '/clodo-framework-api-simplification/' }
      ]},
      { category: 'ðŸŽ“ Guides', items: [
        { label: 'Cloudflare Workers', href: '/cloudflare-workers-guide/' },
        { label: 'Edge Computing', href: '/edge-computing-guide/' }
      ]}
    ]
  },
  { label: 'Pricing', href: '/pricing/' },
  { label: 'Blog', href: '/blog/' }
];
---

<header class="header">
  <nav class="navbar" aria-label="Main navigation">
    <div class="nav-container">
      <!-- Logo -->
      <a href="/" class="logo" aria-label="Clodo Framework home">
        <svg class="logo-icon" aria-hidden="true" width="24" height="24" viewBox="0 0 256 256">
          <defs>
            <linearGradient id="main-logo-g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#1d4ed8"/>
              <stop offset="100%" stop-color="#6366f1"/>
            </linearGradient>
          </defs>
          <rect width="256" height="256" rx="48" fill="#0b1220"/>
          <path d="M144 16l-80 128h56l-8 96 80-128h-56l8-96z" fill="url(#main-logo-g)"/>
        </svg>
        <span class="logo-text">Clodo</span>
      </a>

      <!-- Mobile Menu Toggle -->
      <button 
        id="mobile-menu-toggle" 
        class="mobile-menu-toggle" 
        aria-label="Toggle mobile menu" 
        aria-expanded="false" 
        aria-controls="mobile-menu"
      >
        <span class="hamburger">
          <span class="hamburger__line hamburger__line--top"></span>
          <span class="hamburger__line hamburger__line--middle"></span>
          <span class="hamburger__line hamburger__line--bottom"></span>
        </span>
      </button>

      <!-- Navigation Menu -->
      <ul class="nav-menu" id="mobile-menu" data-visible="false">
        {navItems.map((item) => (
          <li class={item.submenu ? 'nav-dropdown' : ''}>
            <a 
              href={item.href} 
              class={`nav-link ${item.submenu ? 'nav-dropdown-toggle' : ''}`}
              aria-haspopup={item.submenu ? 'true' : undefined}
              aria-expanded={item.submenu ? 'false' : undefined}
            >
              {item.label}
            </a>
            {item.submenu && (
              <ul class="nav-dropdown-menu" role="menu">
                {item.submenu.map((subitem) => (
                  subitem.category ? (
                    <>
                      <li class="nav-dropdown-section">
                        <span class="nav-dropdown-link nav-dropdown-section-title" role="menuitem">
                          <strong>{subitem.category}</strong>
                        </span>
                      </li>
                      {subitem.items?.map((subsubitem) => (
                        <li role="none">
                          <a href={subsubitem.href} class="nav-dropdown-link nav-dropdown-subitem" role="menuitem">
                            {subsubitem.label}
                          </a>
                        </li>
                      ))}
                    </>
                  ) : (
                    <li role="none">
                      <a href={subitem.href} class="nav-dropdown-link" role="menuitem">
                        {subitem.label}
                      </a>
                    </li>
                  )
                ))}
              </ul>
            )}
          </li>
        ))}
      </ul>

      <!-- CTA Button -->
      <a href="https://github.com/tamylaa/clodo-starter-template" class="btn btn--primary nav-cta" aria-label="View on GitHub">
        GitHub
      </a>
    </div>
  </nav>
</header>

<script>
  // Mobile menu toggle functionality
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');

  if (toggle && menu) {
    toggle.addEventListener('click', () => {
      const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', (!isExpanded).toString());
      menu.setAttribute('data-visible', (!isExpanded).toString());
    });

    // Close menu when clicking nav links
    menu.querySelectorAll('.nav-link:not(.nav-dropdown-toggle)').forEach((link) => {
      link.addEventListener('click', () => {
        toggle.setAttribute('aria-expanded', 'false');
        menu.setAttribute('data-visible', 'false');
      });
    });
  }

  // Dropdown toggle for Learn menu
  document.querySelectorAll('.nav-dropdown-toggle').forEach((toggle) => {
    toggle.addEventListener('click', (e) => {
      if (window.innerWidth <= 768) {
        e.preventDefault();
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', (!isExpanded).toString());
      }
    });
  });
</script>

<style>
  .header {
    background: var(--header-bg, #ffffff);
    border-bottom: 1px solid var(--border-color, #e5e7eb);
    position: sticky;
    top: 0;
    z-index: 100;
    transition: background-color 0.3s ease;
  }

  .navbar {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .nav-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.75rem 0;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: inherit;
    font-weight: 600;
    font-size: 1.125rem;
    transition: opacity 0.2s ease;
  }

  .logo:hover {
    opacity: 0.8;
  }

  .logo-icon {
    width: 28px;
    height: 28px;
  }

  .nav-menu {
    display: flex;
    list-style: none;
    gap: 0;
    align-items: center;
    margin: 0;
    padding: 0;
  }

  .nav-link {
    display: block;
    padding: 0.75rem 1rem;
    text-decoration: none;
    color: inherit;
    transition: color 0.2s ease;
    border-radius: 0.375rem;
  }

  .nav-link:hover {
    background-color: var(--hover-bg, #f3f4f6);
  }

  .nav-dropdown {
    position: relative;
  }

  .nav-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--dropdown-bg, #ffffff);
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 0.5rem;
    list-style: none;
    margin: 0.5rem 0 0 0;
    padding: 0.5rem 0;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    min-width: 250px;
  }

  .nav-dropdown:hover .nav-dropdown-menu {
    display: block;
  }

  .nav-dropdown-link {
    display: block;
    padding: 0.5rem 1rem;
    text-decoration: none;
    color: inherit;
    transition: background-color 0.2s ease;
  }

  .nav-dropdown-link:hover {
    background-color: var(--hover-bg, #f3f4f6);
  }

  .nav-dropdown-divider {
    height: 1px;
    background-color: var(--border-color, #e5e7eb);
    margin: 0.5rem 0;
  }

  .mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
  }

  .hamburger {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
  }

  .hamburger__line {
    width: 24px;
    height: 2px;
    background-color: currentColor;
    transition: all 0.3s ease;
  }

  @media (max-width: 768px) {
    .mobile-menu-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      flex-direction: column;
      background-color: var(--dropdown-bg, #ffffff);
      border-bottom: 1px solid var(--border-color, #e5e7eb);
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .nav-menu[data-visible='true'] {
      max-height: 500px;
    }

    .nav-dropdown-menu {
      display: none;
      position: static;
      border: none;
      box-shadow: none;
      background: var(--submenu-bg, #f9fafb);
      margin: 0;
    }

    .nav-dropdown[aria-expanded='true'] .nav-dropdown-menu {
      display: block;
    }

    .nav-cta {
      display: none;
    }
  }
</style>
